<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>COSMIC Toolkit</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="mvu.html"><strong aria-hidden="true">2.</strong> Model-View-Update (MVU)</a></li><li class="chapter-item expanded "><a href="application-trait.html"><strong aria-hidden="true">3.</strong> The Application Trait</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="commands.html"><strong aria-hidden="true">3.1.</strong> Commands</a></li><li class="chapter-item expanded "><a href="subscriptions.html"><strong aria-hidden="true">3.2.</strong> Subscriptions</a></li><li class="chapter-item expanded "><a href="nav-bar.html"><strong aria-hidden="true">3.3.</strong> Nav Bar</a></li><li class="chapter-item expanded "><a href="menu-bar.html"><strong aria-hidden="true">3.4.</strong> Menu Bar</a></li><li class="chapter-item expanded "><a href="context-drawer.html"><strong aria-hidden="true">3.5.</strong> Context Drawer</a></li><li class="chapter-item expanded "><a href="dialogs.html"><strong aria-hidden="true">3.6.</strong> Dialogs</a></li></ol></li><li class="chapter-item expanded "><a href="structure.html"><strong aria-hidden="true">4.</strong> Structure</a></li><li class="chapter-item expanded "><a href="widgets.html"><strong aria-hidden="true">5.</strong> Widgets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="text.html"><strong aria-hidden="true">5.1.</strong> Text</a></li><li class="chapter-item expanded "><a href="container.html"><strong aria-hidden="true">5.2.</strong> Container</a></li><li class="chapter-item expanded "><a href="column.html"><strong aria-hidden="true">5.3.</strong> Column</a></li><li class="chapter-item expanded "><a href="row.html"><strong aria-hidden="true">5.4.</strong> Row</a></li><li class="chapter-item expanded "><a href="buttons.html"><strong aria-hidden="true">5.5.</strong> Buttons</a></li><li class="chapter-item expanded "><a href="icon.html"><strong aria-hidden="true">5.6.</strong> Icon</a></li><li class="chapter-item expanded "><a href="image.html"><strong aria-hidden="true">5.7.</strong> Image</a></li><li class="chapter-item expanded "><a href="svg.html"><strong aria-hidden="true">5.8.</strong> Svg</a></li><li class="chapter-item expanded "><a href="divider.html"><strong aria-hidden="true">5.9.</strong> Divider</a></li><li class="chapter-item expanded "><a href="space.html"><strong aria-hidden="true">5.10.</strong> Space</a></li><li class="chapter-item expanded "><a href="text-input.html"><strong aria-hidden="true">5.11.</strong> Text Input</a></li><li class="chapter-item expanded "><a href="toggler.html"><strong aria-hidden="true">5.12.</strong> Toggler</a></li><li class="chapter-item expanded "><a href="slider.html"><strong aria-hidden="true">5.13.</strong> Slider</a></li><li class="chapter-item expanded "><a href="radio.html"><strong aria-hidden="true">5.14.</strong> Radio</a></li><li class="chapter-item expanded "><a href="check-box.html"><strong aria-hidden="true">5.15.</strong> Check Box</a></li><li class="chapter-item expanded "><a href="dropdown.html"><strong aria-hidden="true">5.16.</strong> Dropdown</a></li><li class="chapter-item expanded "><a href="spin-button.html"><strong aria-hidden="true">5.17.</strong> Spin Button</a></li><li class="chapter-item expanded "><a href="color-picker.html"><strong aria-hidden="true">5.18.</strong> Color Picker</a></li><li class="chapter-item expanded "><a href="flex-row.html"><strong aria-hidden="true">5.19.</strong> Flex Row</a></li><li class="chapter-item expanded "><a href="grid.html"><strong aria-hidden="true">5.20.</strong> Grid</a></li><li class="chapter-item expanded "><a href="segmented-buttons.html"><strong aria-hidden="true">5.21.</strong> Segmented Buttons</a></li><li class="chapter-item expanded "><a href="tab-bar.html"><strong aria-hidden="true">5.22.</strong> Tab Bar</a></li><li class="chapter-item expanded "><a href="segmented-controls.html"><strong aria-hidden="true">5.23.</strong> Segmented Controls</a></li><li class="chapter-item expanded "><a href="context-menu.html"><strong aria-hidden="true">5.24.</strong> Context Menu</a></li><li class="chapter-item expanded "><a href="pane-grid.html"><strong aria-hidden="true">5.25.</strong> Pane Grid</a></li></ol></li><li class="chapter-item expanded "><a href="creating-a-widget.html"><strong aria-hidden="true">6.</strong> Creating a Widget</a></li><li class="chapter-item expanded "><a href="creating-an-overlay.html"><strong aria-hidden="true">7.</strong> Creating an Overlay</a></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">8.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="todo.html"><strong aria-hidden="true">8.1.</strong> Todo</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">COSMIC Toolkit</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><a href="https://github.com/pop-os/libcosmic">libcosmic</a> is the platform toolkit for <a href="cosmic">COSMIC</a>—a GUI toolkit for creating COSMIC-themed applets and applications. Based on the cross-platform <a href="https://iced.rs/">iced</a> GUI library—which it utilizes for its runtime and rendering primitives—the COSMIC toolkit features personalizable desktop theming, a responsive widget library, a configuration system, platform integrations, and its own interface guidelines for building consistent and responsive applications.</p>
<blockquote>
<p>As a Rust-based GUI toolkit, experience with <a href="rust">Rust</a> is required. Rust's rich type system and language features are key to what makes the COSMIC toolkit a much friendlier developer experience—enabling secure, reliable, and efficient applications to be developed at a faster pace than would be possible otherwise. For those interested in learning Rust, there are a lot of good resources available: <a href="https://www.manning.com/books/learn-rust-in-a-month-of-lunches">Learn Rust in a Month of Lunches</a>, <a href="https://www.manning.com/books/rust-in-action">Rust in Action</a>, <a href="https://doc.rust-lang.org/rust-by-example/">Rust by Example</a>, the official <a href="https://doc.rust-lang.org/stable/book/">Rust Book</a>, and <a href="https://github.com/rust-lang/rustlings">Rustlings</a>.</p>
</blockquote>
<p>Although the toolkit was created for the COSMIC desktop environment, it is also cross-platform, and thus it can be used to build COSMIC-themed applications for Linux (X11 &amp; Wayland), <a href="redox-os">Redox OS</a>, Windows, and Mac. Even mobile platforms could be a possibility someday. One of the goals of libcosmic is to enable the creation of a cross-platform ecosystem of applications that are easy to port from one OS to another. We would also welcome any that would like to build their own OS experiences with the COSMIC toolkit.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="model-view-update-mvu"><a class="header" href="#model-view-update-mvu">Model-View-Update (MVU)</a></h1>
<p>The <a href="https://iced.rs/">Iced</a> runtime is an implementation of the MVU (Model-View-Update) design pattern—also known as <a href="https://guide.elm-lang.org/architecture/">TEA (The Elm Architecture)</a>. The MVU design pattern is a functional approach to GUI design that consists of an event loop with ownership of the application's struct—aka the Model, a view function for generating a View from that model, and an update function for updating the Model.</p>
<p>Similar to how Elm was created, this architecture also emerged naturally in the Rust ecosystem as everyone searched for ways to model applications and services which adhere to Rust's <a href="https://cmpt-479-982.github.io/week1/safety_features_of_rust.html#the-borrow-checker-and-the-aliasing-xor-mutability-principle">aliasing XOR mutability rule</a>. This can be seen with the rise of similar frameworks, such as <a href="https://crates.io/crates/sauron">Sauron</a>, <a href="https://crates.io/crates/relm4">Relm4</a>, and <a href="https://crates.io/crates/tuirealm">tui-realm</a>. At any given point, the application's model is either being immutably borrowed by its view, or is being mutatbly borrowed by its update method. Thus it eliminates the need for shared references, interior mutability, and runtime borrow checking.</p>
<p>To describe this in code, see the <a href="https://book.iced.rs/the-runtime.html#looping-around">iced.rs book</a> example here:</p>
<pre><code class="language-rs">use magic::{display, interact};

// Initialize the state
let mut counter = Counter::default();

// Be interactive. All the time! 
loop {
    // Run our view logic to obtain our interface
    let interface = counter.view();

    // Display the interface to the user
    display(&amp;interface);

    // Process the user interactions and obtain our messages
    let messages = interact(&amp;interface);

    // Update our state by processing each message
    for message in messages {
        counter.update(message);
    }
}
</code></pre>
<p>In each iteration of the event loop, the runtime calls the view method of the application's Model to create a new View. The View is a state machine whose purpose is both to describe the layout of the interface and how to draw it; and to be a streamlined pipeline for processing UI events and yielding any Messages from widgets in the View that they triggered. The View can efficiently borrow data directly from the Model because the View has the same lifetime as the borrowed Model.</p>
<blockquote>
<p>Because the majority of the runtime is likely to be spent in drawing, the runtime will diff the layout and state of the View to detect when there is a need to redraw a node in the widget tree. The runtime will also cache certain elements between frames—such as images—to prevent the need to redraw them.</p>
</blockquote>
<p>Once the View has been drawn, the runtime will wait for UI events—such as mouse and keyboard events—and process them directly through the View. Those events will be pass through various widgets which may emit any number of Messages in response. After the View has processed the UI event(s), the View is dropped and any received Messages will be passed through the Model's update method, which mutably borrows the Model.</p>
<p>The update method uses pattern matching to find the appropriate branch to execute (which is much faster than dynamic dispatch), and the programmer can then update the model while running any application logic necessary. Once the update method has completed, the next iteration of the loop begins.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-application-trait"><a class="header" href="#the-application-trait">The Application Trait</a></h1>
<blockquote>
<p>Before beginning, I would recommend cloning the <a href="https://github.com/pop-os/cosmic-app-template">COSMIC App Template</a> to experiment with while reading the documentation below.</p>
</blockquote>
<h2 id="model"><a class="header" href="#model">Model</a></h2>
<p>Every application begins with the application model. All application state will be stored in this model, and it will be wise to cache data that will be needed by your application's widgets. It is important that it contains at least a <a href="https://pop-os.github.io/libcosmic/cosmic/app/struct.Core.html">cosmic::app::Core</a>, which will provide a way of interacting with certain aspects of the COSMIC app runtime.</p>
<pre><code class="language-rs">use cosmic::prelude::*;

struct AppModel {
    core: cosmic::app::Core,
    counter: u32,
    counter_text: String,
}
</code></pre>
<h2 id="message"><a class="header" href="#message">Message</a></h2>
<p>Alongside that struct, there will also be a Message type, which describes the kinds of events that widgets in the applications are going to emit.</p>
<pre><code class="language-rs">#[derive(Debug, Clone)]
pub enum Message {
    Clicked
}
</code></pre>
<h2 id="the-trait"><a class="header" href="#the-trait">The Trait</a></h2>
<p>Together, these will be used to create a <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.Application.html">cosmic::Application</a>. Implementing this trait will automatically generate all of the necessary code to run a COSMIC application which integrates consistently within the COSMIC desktop.</p>
<p>Note that the following associated types and constants are required:</p>
<ul>
<li><code>Executor</code> is the async executor that will be used to run your application's commands.</li>
<li><code>Flags</code> is the data that your application needs to use before it starts.</li>
<li><code>Message</code> is the enum that contains all the possible variants that your application will need to transmit messages.</li>
<li><code>APP_ID</code> is the unique identifier of your application.</li>
</ul>
<p>We also need to provide methods to enable the COSMIC app runtime to access the application's Core.</p>
<pre><code class="language-rs">impl cosmic::Application for AppModel {
    type Executor = cosmic::executor::Default;
    type Flags = ();
    type Message = Message;

    const APP_ID: &amp;str = "tld.domain.AppName";

    fn core(&amp;self) -&gt; &amp;Core {
        &amp;self.core
    }

    fn core_mut(&amp;mut self) -&gt; &amp;mut Core {
        &amp;mut self.core
    }
}
</code></pre>
<h2 id="init"><a class="header" href="#init">Init</a></h2>
<p>This is where your application model will be constructed, and any necessary tasks scheduled for execution on init. This will typically be where you want to set the name of the window title.</p>
<pre><code class="language-rs">fn init(core: Core, _flags: Self::Flags) -&gt; (Self, Command&lt;Self::Message&gt;) {
    let mut app = AppModel {
        core,
        counter: 0,
        counter_text: String::new(),
    };

    app.counter_text = format!("Clicked {} times", app.counter);
  
    let command = app.set_window_title("AppName");

    (app, command)
}
</code></pre>
<h2 id="view"><a class="header" href="#view">View</a></h2>
<p>At the beginning of each iteration of the runtime's event loop, the <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.Application.html#tymethod.view">view method</a> will be called to create a view which describes the current state of the UI. The returned state machine defines the layout of the interface, how it is to be drawn, and what messages widgets will emit when triggered by certain UI events.</p>
<pre><code class="language-rs">impl cosmic::Application for AppModel {
    ...
    
    /// The returned Element has the same lifetime as the model being borrowed.
    fn view(&amp;self) -&gt; Element&lt;Self::Message&gt; {
        let button = widget::button(&amp;self.counter_text)
            .on_press(Message::Clicked);
            
        widget::container(button)
            .width(iced::Length::Fill)
            .height(iced::Length::Shrink)
            .center_x()
            .center_y()
            .into()
    }
}
</code></pre>
<p>This method will be composed from widget functions that you can get from the <a href="https://pop-os.github.io/libcosmic/cosmic/widget/index.html">cosmic::widget</a> module. Note that widgets are composed functionally, and therefore they are designed to have their fields set through a <a href="https://rust-unofficial.github.io/patterns/patterns/creational/builder.html">Builder pattern</a>.</p>
<h2 id="update"><a class="header" href="#update">Update</a></h2>
<p>Messages emitted by the view will later be passed through the application's <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.Application.html#method.update">update method</a>. This will use Rust's pattern matching to choose a branch to execute, make any changes necessary to the application's model, and may optionally return one or more commands.</p>
<pre><code class="language-rs">impl cosmic::Application for AppModel {
    ...
    
    fn update(&amp;mut self, message: Self::Message) -&gt; Command&lt;Self::Message&gt; {
        match message {
            Message::Clicked =&gt; {
                self.counter += 1;
                self.counter_text = format!("Clicked {} times", self.counter);
            }
        }
        
        Command::none()
    }
}
</code></pre>
<p>Because this method executes in the runtime's event loop, the application will block for the duration that this method is being called. It is therefore imperative that any application logic executed here should be swift to prevent the user from experiencing an application freeze. Anything that requires either asynchronous or long execution time should either be returned as a <a href="commands.html">Command</a>, or placed into a <a href="subscriptions.html">Subscription</a>.</p>
<h2 id="running-the-application"><a class="header" href="#running-the-application">Running the application</a></h2>
<p>Once the trait has been implemented, you can run it from your main function like so:</p>
<pre><code class="language-rs">fn main() -&gt; cosmic::iced::Result {
    let settings = cosmic::app::Settings::default();
    cosmic::app::run::&lt;AppModel&gt;(settings, ())
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<p><a href="https://pop-os.github.io/libcosmic/cosmic/iced_winit/runtime/struct.Command.html">Commands</a> are short-lived async tasks that are spawned onto an async executor on a background thread. They must return a message back to the application upon completion, and cannot directly send messages back to the application until they return.</p>
<blockquote>
<p><strong>NOTE</strong>: While it is not possible for a command to directly send messages before completion, it is possible to create a subscription from a channel which passes its sender to the application, which may then pass that sender into its commands.</p>
</blockquote>
<h2 id="future"><a class="header" href="#future">Future</a></h2>
<p>Commands may be created from futures using <a href="future">cosmic::command::future</a>.</p>
<pre><code class="language-rs">fn update(&amp;mut self, message: Self::Message) -&gt; Command&lt;Self::Message&gt; {
    match message {
        Message::Clicked =&gt; {
            self.counter += 1;
            self.counter_text = format!("Clicked {} times", self.counter);
            
            // Await for 3 seconds in the background, and then request to decrease the counter.
            return cosmic::command::future(async move {
                tokio::time::sleep(Duration::from_millis(3000)).await;
                Message::Decrease
            });
        }
        
        Message::Decrease =&gt;  {
            self.counter -= 1;
            self.counter_text = format!("Clicked {} times", self.counter);
        }
    }
    
    Command::none()
}
</code></pre>
<h2 id="batches"><a class="header" href="#batches">Batches</a></h2>
<p>They can also be <a href="https://pop-os.github.io/libcosmic/cosmic/command/fn.batch.html">batched</a> for concurrent execution, where messages will be received in the order of completion.</p>
<pre><code class="language-rs">fn update(&amp;mut self, message: Self::Message) -&gt; Command&lt;Self::Message&gt; {
    match message {
        Message::BatchStarted =&gt; {
            eprintln!("started handling batch");
        }

        Message::Clicked =&gt; {
            self.counter += 1;
            self.counter_text = format!("Clicked {} times", self.counter);
            
            // Run two async tasks concurrently.
            return cosmic::command::batch(vec![
                // Await for 3 seconds in the background, and then request to decrease the counter.
                cosmic::command::future(async move {
                    tokio::time::sleep(Duration::from_millis(3000)).await;
                    Message::Decrease
                }),
                // Immediately returns a message without waiting.
                cosmic::command::message(Message::BatchStarted)
            ]);
        }
        
        Message::Decrease =&gt;  {
            self.counter -= 1;
            self.counter_text = format!("Clicked {} times", self.counter);
        }
    }
    
    Command::none()
}
</code></pre>
<h2 id="widget-operations"><a class="header" href="#widget-operations">Widget Operations</a></h2>
<p>They can also be used to perform an operation onto a widget, such as focusing a button or text input.</p>
<pre><code class="language-rs">return cosmic::widget::button::focus(self.BUTTON_ID);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="subscriptions"><a class="header" href="#subscriptions">Subscriptions</a></h1>
<p>Subscriptions are long-running async tasks which listen for external events passively, and forward Messages back to the application runtime. They can be used to continuously monitor events for the entire lifetime of the application.</p>
<h2 id="channels"><a class="header" href="#channels">Channels</a></h2>
<p>The most common form of a subscription will be that of a channel. This will effectively behave as an async generator which yields messages to the application runtime. The source of your events could be from a channel, async stream, or a custom event loop.</p>
<pre><code class="language-rs">struct MySubscription;
let subscription = cosmic::subscription::channel(
    std::any::TypeId::of::&lt;MySubscription&gt;(),
    4,
    move |mut output| async move {
        let stream = streamable_operation();

        while let Some(event) = stream.next().await {
            let _res = output.send(Message::StreamedMessage(event)).await;
        }

        futures::future::pending().await
    },
);
</code></pre>
<h2 id="batches-1"><a class="header" href="#batches-1">Batches</a></h2>
<p>If your application needs more than one Subscription, you can batch them together in one with <code>Subscription::batch</code>.</p>
<pre><code class="language-rs">Subscription::batch(vec![
    subscription1,
    subscription2,
    subscription3,
])
</code></pre>
<h2 id="forwarding-messages-from-commands"><a class="header" href="#forwarding-messages-from-commands">Forwarding messages from commands</a></h2>
<p>This trick enables Commands to yield Messages to the application before they are finished.</p>
<pre><code class="language-rs">struct MessageForwarder;
let subscription = cosmic::subscription::channel(
    std::any::TypeId::of::&lt;MessageForwarder&gt;(),
    4,
    move |mut output| async move {
        let (tx, mut rx) = tokio::sync::mpsc::channel::&lt;Message&gt;(4);

        let _res = output.send(Message::RegisterSubscriptionSender(tx)).await;

        while let Some(event) = rx.recv().await {
            let _res = output.send(event).await;
        }

        futures::future::pending().await
    },
);
</code></pre>
<p>A channel will be created which sends its Sender directly to the application with a Message. You will store this message inside of your application like so:</p>
<pre><code class="language-rs">Message::RegisterSubscriptionSender(sender) =&gt; {
    self.sender = Some(sender);
}
</code></pre>
<p>Then you can clone the sender when creating commands that need to forward messages back to the runtime.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nav-bar"><a class="header" href="#nav-bar">Nav Bar</a></h1>
<p>COSMIC's Nav Bar is a common element found in most applications with navigatable interfaces. The <code>cosmic::Application</code> trait comes with some predefined methods that can be optionally set to enable integration with the Nav Bar with minimal setup.</p>
<p>First, it is necessary to add the <a href="https://pop-os.github.io/libcosmic/cosmic/widget/nav_bar/type.Model.html">nav_bar::Model</a> to your application's model.</p>
<pre><code class="language-rs">struct AppModel {
    /// A model that contains all of the pages assigned to the nav bar panel.
    nav: nav_bar::Model,
}
</code></pre>
<p>The nav bar can then be enabled by implementing these methods in your <code>cosmic::Application</code> trait.</p>
<pre><code class="language-rs">/// Enable the nav bar to appear in your application when `Some`.
fn nav_model(&amp;self) -&gt; Option&lt;&amp;nav_bar::Model&gt; {
    Some(&amp;self.nav)
}

/// Activate the nav item when selected.
fn on_nav_select(&amp;mut self, id: nav_bar::Id) -&gt; Command&lt;Self::Message&gt; {
    // Activate the page in the model.
    self.nav.activate(id);
}
</code></pre>
<p>Items can be added and modified from the init or update methods.</p>
<pre><code class="language-rs">fn init(core: Core, _flags: Self::Flags) -&gt; (Self, Command&lt;Self::Message&gt;) {
    let mut nav = nav_bar::Model::default();

    nav.insert()
        .text("Page 1")
        .data::&lt;Page&gt;(Page::Page1)
        .icon(icon::from_name("applications-science-symbolic"))
        .activate();

    nav.insert()
        .text("Page 2")
        .data::&lt;Page&gt;(Page::Page2)
        .icon(icon::from_name("applications-system-symbolic"));

    nav.insert()
        .text("Page 3")
        .data::&lt;Page&gt;(Page::Page3)
        .icon(icon::from_name("applications-games-symbolic"));

    let mut app = YourApp {
        core,
        nav,
    };

    (app, Command::none())
}
</code></pre>
<p>Each item in the model can hold any number of custom data types, which can be fetched by their type.</p>
<pre><code class="language-rs">if let Some(page) = self.nav.data::&lt;Page&gt;().copied() {
    eprintln!("the current page is {page}");
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="menubar"><a class="header" href="#menubar">MenuBar</a></h1>
<p>It is also recommended for applications to provide menu bars whenever they have sufficient need to display a variety of selectable options. See the <a href="https://pop-os.github.io/libcosmic/cosmic/widget/menu/index.html">cosmic::widget::menus</a> module for more details on the APIs available for menu creation.</p>
<blockquote>
<p>In the future, menu bars will be a source for interacting with global menus.</p>
</blockquote>
<h2 id="defining-menuactions"><a class="header" href="#defining-menuactions">Defining MenuAction(s)</a></h2>
<p>Menu bars have their own custom message types. This one will provide just an about settings page.</p>
<pre><code class="language-rs">#[derive(Clone, Copy, Debug, Eq, PartialEq)]
pub enum MenuAction {
    About,
}
</code></pre>
<p>For this type to be usable with a menu bar, it needs to implement the <a href="https://pop-os.github.io/libcosmic/cosmic/widget/menu/action/trait.MenuAction.html">menu::Action</a> trait. This defines which application message that the menu action should convert into.</p>
<pre><code class="language-rs">impl menu::Action for MenuAction {
    type Message = Message;

    fn message(&amp;self) -&gt; Self::Message {
        match self {
            MenuAction::About =&gt; Message::ToggleContextPage(ContextPage::About),
        }
    }
}
</code></pre>
<h2 id="keybindings"><a class="header" href="#keybindings">Keybindings</a></h2>
<p>Your preferred key bindings for these menu actions should also be attached to your application's model.</p>
<pre><code class="language-rs">struct AppModel {
    /// Key bindings for the application's menu bar.
    key_binds: HashMap&lt;menu::KeyBind, MenuAction&gt;,
}
</code></pre>
<h2 id="add-to-cosmicapplication"><a class="header" href="#add-to-cosmicapplication">Add to <code>cosmic::Application</code></a></h2>
<p>You can add then add a menu bar to the start of your application's header bar by defining this method in your <code>cosmic::Application</code> implementation.</p>
<pre><code class="language-rs">/// Elements to pack at the start of the header bar.
fn header_start(&amp;self) -&gt; Vec&lt;Element&lt;Self::Message&gt;&gt; {
    let menu_bar = menu::bar(vec![menu::Tree::with_children(
        menu::root(fl!("view")),
        menu::items(
            &amp;self.key_binds,
            vec![menu::Item::Button(fl!("about"), MenuAction::About)],
        ),
    )]);

    vec![menu_bar.into()]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="context-drawer"><a class="header" href="#context-drawer">Context Drawer</a></h1>
<p>COSMIC applications use the Context Drawer to display additional application context for a select context. This overlay widget will be placed above the contents of the window on the right side of the application window.</p>
<h2 id="context-page"><a class="header" href="#context-page">Context Page</a></h2>
<p>As the context drawer is a reusable element, you want to define a type for describing which context to show. To start with, we will make a context page which shows an about page. This will require that your application has the menu bar added to it from the previous chapter.</p>
<pre><code class="language-rs">/// Identifies a context page to display in the context drawer.
#[derive(Copy, Clone, Debug, Default, Eq, PartialEq)]
pub enum ContextPage {
    #[default]
    About,
}

impl ContextPage {
    fn title(&amp;self) -&gt; String {
        match self {
            Self::About =&gt; fl!("about"),
        }
    }
}
</code></pre>
<p>You will also want to assign this to your application model</p>
<pre><code class="language-rs">struct AppModel {
    /// Display a context drawer with the designated page if defined.
    context_page: ContextPage,
}
</code></pre>
<h2 id="cosmicapplication-integration"><a class="header" href="#cosmicapplication-integration">cosmic::Application integration</a></h2>
<p>The <code>context_drawer</code> method can be defined to show the context drawer. When this method returns an Element, the context drawer will be displayed. The COSMIC runtime keeps track of when the context drawer should be shown, so we can use this as a hint to when we can show it or not. How you define the view of this page is up to you.</p>
<pre><code class="language-rs">/// Display a context drawer if the context page is requested.
fn context_drawer(&amp;self) -&gt; Option&lt;Element&lt;Self::Message&gt;&gt; {
    if !self.core.window.show_context {
        return None;
    }

    Some(match self.context_page {
        ContextPage::About =&gt; self.about(),
    })
}
</code></pre>
<h2 id="toggling-the-context-drawer"><a class="header" href="#toggling-the-context-drawer">Toggling the context drawer</a></h2>
<p>In the previous chapter, we defined a message for toggling the context drawer and assigning the page. This glue will toggle the visibility of the context drawer, assign the context page, and set the title of the context drawer. Note that the <code>set_context_title</code> is a method from <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.ApplicationExt.html#method.set_context_title">cosmic::ApplicationExt</a>. This method sets the title of the context page in the <code>cosmic::app::Core</code>.</p>
<pre><code class="language-rs">match message {
    Message::ToggleContextPage(context_page) =&gt; {
        if self.context_page == context_page {
            // Close the context drawer if the toggled context page is the same.
            self.core.window.show_context = !self.core.window.show_context;
        } else {
            // Open the context drawer to display the requested context page.
            self.context_page = context_page;
            self.core.window.show_context = true;
        }

        // Set the title of the context drawer.
        self.set_context_title(context_page.title());
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dialogs"><a class="header" href="#dialogs">Dialogs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="structure"><a class="header" href="#structure">Structure</a></h1>
<p>Given that all application state will be stored into one top level application struct, you may be wondering how to manage the complexity of the model. The general advice is not to feel bad about having a model with a lot of fields, a large view method with a many lines of code, and a large update method with many message variants. This is a feature of the MVU design pattern which centralizes the logic in a way that is easy to refactor and reorganize as your application grows naturally.</p>
<p>Use descriptive names when adding new fields to your application model, and group fields together into structs when you feel that it is necessary.</p>
<pre><code class="language-rs"></code></pre>
<p>Likewise, you may find it useful to create additional message types which you can wrap in your top level message enum.</p>
<pre><code class="language-rs">enum Message {
    VariantA,
    VariantB,
    VariantC(CMessage)
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="widgets"><a class="header" href="#widgets">Widgets</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="text"><a class="header" href="#text">Text</a></h1>
<p>The <a href="https://pop-os.github.io/libcosmic/cosmic/widget/text/index.html">text module</a> provides a variety of standard typography presets to use in your applications.</p>
<p><a href="./typography.svg"><img src="./typography.svg" alt="" /></a></p>
<pre><code class="language-rs">let body = widget::text::body("Body");
</code></pre>
<pre><code class="language-rs">let caption = widget::text::caption("Caption");
</code></pre>
<pre><code class="language-rs">let caption_heading = widget::text::caption_heading("Caption Heading");
</code></pre>
<pre><code class="language-rs">let heading = widget::text::heading("Heading");
</code></pre>
<pre><code class="language-rs">let monotext = widget::text::monotext("Monotext");
</code></pre>
<pre><code class="language-rs">let title1 = widget::text::title1("Title 1");
</code></pre>
<pre><code class="language-rs">let title2 = widget::text::title2("Title 2");
</code></pre>
<pre><code class="language-rs">let title3 = widget::text::title3("Title 3");
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="container"><a class="header" href="#container">Container</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="column"><a class="header" href="#column">Column</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="row"><a class="header" href="#row">Row</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="buttons"><a class="header" href="#buttons">Buttons</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="icon"><a class="header" href="#icon">Icon</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="image"><a class="header" href="#image">Image</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="svg"><a class="header" href="#svg">Svg</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="divider"><a class="header" href="#divider">Divider</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="space"><a class="header" href="#space">Space</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="text-input"><a class="header" href="#text-input">Text Input</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="toggler"><a class="header" href="#toggler">Toggler</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="slider"><a class="header" href="#slider">Slider</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="radio"><a class="header" href="#radio">Radio</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="check-box"><a class="header" href="#check-box">Check Box</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dropdown"><a class="header" href="#dropdown">Dropdown</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="spin-button"><a class="header" href="#spin-button">Spin Button</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="color-picker"><a class="header" href="#color-picker">Color Picker</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="flex-row"><a class="header" href="#flex-row">Flex Row</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="grid"><a class="header" href="#grid">Grid</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="segmented-buttons"><a class="header" href="#segmented-buttons">Segmented Buttons</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tab-bar"><a class="header" href="#tab-bar">Tab Bar</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="segmented-controls"><a class="header" href="#segmented-controls">Segmented Controls</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="context-menu"><a class="header" href="#context-menu">Context Menu</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pane-grid"><a class="header" href="#pane-grid">Pane Grid</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-widget"><a class="header" href="#creating-a-widget">Creating a Widget</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-an-overlay"><a class="header" href="#creating-an-overlay">Creating an Overlay</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="todo"><a class="header" href="#todo">Todo</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
